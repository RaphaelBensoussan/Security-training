<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Rapport de S√©curit√©</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        h1 { color: #2c3e50; }
        section { margin-bottom: 2rem; }
        ul { padding-left: 1.5rem; }
        li { margin-bottom: 0.5rem; }
        .severity-low { color: green; }
        .severity-medium { color: orange; }
        .severity-high, .severity-critical { color: red; }
    </style>
</head>
<body>
<h1>üõ°Ô∏è Rapport de S√©curit√©</h1>

<section>
    <h2>Snyk - Vuln√©rabilit√©s d√©tect√©es</h2>
    {% if snyk.vulnerabilities %}
    <ul>
        {% for vuln in snyk.vulnerabilities %}
        <li>
            <strong>{{ vuln.title }}</strong> ‚Äî
            <span class="severity-{{ vuln.severity }}">{{ vuln.severity|capitalize }}</span> <br>
            <small>{{ vuln.packageName }} ({{ vuln.version }})</small>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>Aucune vuln√©rabilit√© d√©tect√©e par Snyk.</p>
    {% endif %}
</section>

<section>
    <h2>GitLeaks - Secrets d√©tect√©s</h2>
    {% if gitleaks.runs and gitleaks.runs[0].results %}
    <ul>
        {% for secret in gitleaks.runs[0].results %}
        <li>
            <strong>{{ secret.ruleId }}</strong> ‚Äî {{ secret.message }}<br>
            <small>Fichier : {{ secret.locations[0].physicalLocation.artifactLocation.uri }}</small>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>Aucun secret d√©tect√© par GitLeaks.</p>
    {% endif %}
</section>

<section>
    <h2>Trivy - Vuln√©rabilit√©s d'image Docker</h2>
    {% if trivy.Results %}
    {% for result in trivy.Results if result.Vulnerabilities %}
    <h3>{{ result.Target }}</h3>
    <ul>
        {% for vuln in result.Vulnerabilities %}
        <li>
            <strong>{{ vuln.Title or vuln.VulnerabilityID }}</strong> ‚Äî
            <span class="severity-{{ vuln.Severity|lower }}">{{ vuln.Severity|capitalize }}</span> <br>
            <small>Paquet : {{ vuln.PkgName }} {{ vuln.InstalledVersion }}</small>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>Aucune vuln√©rabilit√© d√©tect√©e par Trivy.</p>
    {% endfor %}
    {% else %}
    <p>Aucune vuln√©rabilit√© d√©tect√©e par Trivy.</p>
    {% endif %}
</section>

</body>
</html>
